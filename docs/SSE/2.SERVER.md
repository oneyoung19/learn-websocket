# Server-sent

为了能使 `SSE` 正常工作，`Server` 端也需要作一些对应设置。

本节中 `server` 端相关代码，以 `express` 框架作为示范。

## 1.响应头配置

`SSE` 的响应头配置是固定的，有以下三条：

```js
// 定义响应数据为事件流类型
res.setHeader('Content-Type', 'text/event-stream')

// 定义客户端不进行清缓存 保证每次请求结果都是更新的
res.setHeader('Cache-Control', 'no-cache')

// 定义长连接 客户端EventSource会发送Connection请求头 此处作对应设置以保证长连接
res.setHeader('Connection', 'keep-alive')
```

## 2.响应体格式

`SSE` 的**一次的响应体推送，我们称作一个 `message`**。

`message` 的数据格式是**字符串文本**。

该 `message` 由 `[field]: value` 键值对格式的字符串拼接起来：

- **每个键值对之间需要使用 `\n` 分割开来**；
- **每个 `message` 末尾以 `\n\n` 结尾**。

`field` 只支持如下 `4` 个固定字段：

1. `event`
2. `data`
3. `id`
4. `retry`

单个 `message` 的格式可能如下：

```js
// 1
`event:foo\nid:foo\nretry: 10000\ndata:{ message: 'foo' }\n\n`

// 2
`event:bar\ndata:{ message: 'bar' }\n\n`
```

### 2-1.event

### 2-2.data

### 2-3.id

### 2-4.retry
